# 08-05-2015: Mapper funtions for videotextmath experiment
# Brad, Ross, Brandon, Matt, Karthik
library(plyr)

# Funtion to filter data for analysis
GetAnalysisSubset1 <- function(df) {
  trim <- function (x) gsub("^\\s+|\\s+$", "", x)
  dfsubset <- df[, c("ResponseID",
                     "ResponseSet",
                     "Name",
                     "ExternalDataReference",
                     "EmailAddress",
                     "IPAddress",
                     "Status",
                     "StartDate",
                     "EndDate",
                     "Finished",
                     "random",
                     "leveled",
                     "skillmath",
                     "englishreading",
                     "englishlistening",
                     "ageyears",
                     "gender1m",
                     "countrybirth",
                     "countryresidence",
                     "SurveyBegin",
                     "pre1_10",
                     "pre2_10",
                     "pre3_6",
                     "pre4_10",
                     "pre5_c",
                     "pre6_4",
                     "textmath",
                     "videomath",
                     "placebo",
                     "post1_15",
                     "post2_3",
                     "post3_6",
                     "post4_35",
                     "post5_c",
                     "post6_4",
                     "confirmationcode",
                     "LocationLatitude",
                     "LocationLongitude",
                     "LocationAccuracy")]
  dfsubset$ResponseSet <-ifelse(as.Date(dfsubset$StartDate) < as.Date("2015-08-10"), "Survey08072015","Survey08112015")
  dfsubset$pre1Result <-ifelse(trim(dfsubset$pre1_10) == "10", 1,0)
  dfsubset$pre2Result <-ifelse(trim(dfsubset$pre2_10) == "10", 1,0)
  dfsubset$pre3Result <-ifelse(trim(dfsubset$pre3_6) == "6", 1,0)
  dfsubset$pre4Result <-ifelse(trim(dfsubset$pre4_10) == "10", 1,0)
  dfsubset$pre5Result <-ifelse(tolower(trim(dfsubset$pre5_c)) == "c", 1,0)
  dfsubset$pre6Result <-ifelse(trim(dfsubset$pre6_4) == "4", 1,0)
  dfsubset$post1Result <-ifelse(trim(dfsubset$post1_15) == "15", 1,0)
  dfsubset$post2Result <-ifelse(trim(dfsubset$post2_3) == "3", 1,0)
  dfsubset$post3Result <-ifelse(trim(dfsubset$post3_6) == "6", 1,0)
  dfsubset$post4Result <-ifelse(trim(dfsubset$post4_35) == "35", 1,0)
  dfsubset$post5Result <-ifelse(tolower(trim(dfsubset$post5_c)) == "c", 1,0)
  dfsubset$post6Result <-ifelse(trim(dfsubset$post6_4) == "4", 1,0)
  dfsubset$prescore <- dfsubset$pre1Result+dfsubset$pre2Result+dfsubset$pre3Result+dfsubset$pre4Result+dfsubset$pre5Result+dfsubset$pre6Result
  dfsubset$postscore <- dfsubset$post1Result+dfsubset$post2Result+dfsubset$post3Result+dfsubset$post4Result+dfsubset$post5Result+dfsubset$post6Result
  dfsubset$d_in_d <- (dfsubset$postscore - dfsubset$prescore)
  testtime <- as.POSIXlt(dfsubset$EndDate)-as.POSIXlt(dfsubset$StartDate)
  dfsubset$textmath <-ifelse(dfsubset$textmath == "1", 1,0)
  dfsubset$videomath <-ifelse(dfsubset$videomath == "1", 1,0)
  dfsubset$placebo <-ifelse(dfsubset$placebo == "1", 1,0)
  dfsubset$treatmentgroup <-ifelse(dfsubset$textmath == 1, "Textmath",ifelse(dfsubset$videomath == 1, "Videomath","Control"))
  return(dfsubset)
}

# Funtion to rename dataframe to userfriendly columns 
Renamecols <- function(df) {
  colnames(df)<- c(
    "ResponseID",
    "ResponseSet",
    "Name",
    "ExternalDataReference",
    "EmailAddress",
    "IPAddress",
    "Status",
    "StartDate",
    "EndDate",
    "Finished",
    "random",
    "leveledfclick",
    "leveledlclick",
    "leveledpagesubmit",
    "leveledclickcount",
    "leveled",
    "skillmathfclick",
    "skillmathlclick",
    "skillmathpagesubmit",
    "skillmathclickcount",
    "skillmath",
    "englishreadingfclick",
    "englishreadinglclick",
    "englishreadingpagesubmit",
    "englishreadingclickcount",
    "englishreading",
    "englishlisteningfclick",
    "englishlisteninglclick",
    "englishlisteningpagesubmit",
    "englishlisteningclickcount",
    "englishlistening",
    "ageyearsfclick",
    "ageyearslclick",
    "ageyearspagesubmit",
    "ageyearsclickcount",
    "ageyears",
    "gender1mfclick",
    "gender1mlclick",
    "gender1mpagesubmit",
    "gender1mclickcount",
    "gender1m",
    "countrybirthfclick",
    "countrybirthlclick",
    "countrybirthpagesubmit",
    "countrybirthclickcount",
    "countrybirth",
    "countryresidencefclick",
    "countryresidencelclick",
    "countryresidencepagesubmit",
    "countryresidenceclickcount",
    "countryresidence",
    "SurveyBegin",
    "pre1_10fclick",
    "pre1_10lclick",
    "pre1_10pagesubmit",
    "pre1_10clickcount",
    "pre1_10",
    "pre2_10fclick",
    "pre2_10lclick",
    "pre2_10pagesubmit",
    "pre2_10clickcount",
    "pre2_10",
    "pre3_6fclick",
    "pre3_6lclick",
    "pre3_6pagesubmit",
    "pre3_6clickcount",
    "pre3_6",
    "pre4_10fclick",
    "pre4_10lclick",
    "pre4_10pagesubmit",
    "pre4_10clickcount",
    "pre4_10",
    "pre5_cfclick",
    "pre5_clclick",
    "pre5_cpagesubmit",
    "pre5_cclickcount",
    "pre5_c",
    "pre6_4fclick",
    "pre6_4lclick",
    "pre6_4pagesubmit",
    "pre6_4clickcount",
    "pre6_4",
    "textmathfclick",
    "textmathlclick",
    "textmathpagesubmit",
    "textmathclickcount",
    "textmath",
    "videomathfclick",
    "videomathlclick",
    "videomathpagesubmit",
    "videomathclickcount",
    "videomath",
    "placebofclick",
    "placebolclick",
    "placebopagesubmit",
    "placeboclickcount",
    "placebo",
    "post1_15fclick",
    "post1_15lclick",
    "post1_15pagesubmit",
    "post1_15clickcount",
    "post1_15",
    "post2_3fclick",
    "post2_3lclick",
    "post2_3pagesubmit",
    "post2_3clickcount",
    "post2_3",
    "post3_6fclick",
    "post3_6lclick",
    "post3_6pagesubmit",
    "post3_6clickcount",
    "post3_6",
    "post4_35fclick",
    "post4_35lclick",
    "post4_35pagesubmit",
    "post4_35clickcount",
    "post4_35",
    "post5_cfclick",
    "post5_clclick",
    "post5_cpagesubmit",
    "post5_cclickcount",
    "post5_c",
    "post6_4fclick",
    "post6_4lclick",
    "post6_4pagesubmit",
    "post6_4clickcount",
    "post6_4",
    "confirmationcode",
    "LocationLatitude",
    "LocationLongitude",
    "LocationAccuracy"
  )
  return(df)
}

# Funtion to rename dataframe to userfriendly columns 
RenamecolsNoplacebo <- function(df) {
  colnames(df)<- c(
    "ResponseID",
    "ResponseSet",
    "Name",
    "ExternalDataReference",
    "EmailAddress",
    "IPAddress",
    "Status",
    "StartDate",
    "EndDate",
    "Finished",
    "random",
    "leveledfclick",
    "leveledlclick",
    "leveledpagesubmit",
    "leveledclickcount",
    "leveled",
    "skillmathfclick",
    "skillmathlclick",
    "skillmathpagesubmit",
    "skillmathclickcount",
    "skillmath",
    "englishreadingfclick",
    "englishreadinglclick",
    "englishreadingpagesubmit",
    "englishreadingclickcount",
    "englishreading",
    "englishlisteningfclick",
    "englishlisteninglclick",
    "englishlisteningpagesubmit",
    "englishlisteningclickcount",
    "englishlistening",
    "ageyearsfclick",
    "ageyearslclick",
    "ageyearspagesubmit",
    "ageyearsclickcount",
    "ageyears",
    "gender1mfclick",
    "gender1mlclick",
    "gender1mpagesubmit",
    "gender1mclickcount",
    "gender1m",
    "countrybirthfclick",
    "countrybirthlclick",
    "countrybirthpagesubmit",
    "countrybirthclickcount",
    "countrybirth",
    "countryresidencefclick",
    "countryresidencelclick",
    "countryresidencepagesubmit",
    "countryresidenceclickcount",
    "countryresidence",
    "SurveyBegin",
    "pre1_10fclick",
    "pre1_10lclick",
    "pre1_10pagesubmit",
    "pre1_10clickcount",
    "pre1_10",
    "pre2_10fclick",
    "pre2_10lclick",
    "pre2_10pagesubmit",
    "pre2_10clickcount",
    "pre2_10",
    "pre3_6fclick",
    "pre3_6lclick",
    "pre3_6pagesubmit",
    "pre3_6clickcount",
    "pre3_6",
    "pre4_10fclick",
    "pre4_10lclick",
    "pre4_10pagesubmit",
    "pre4_10clickcount",
    "pre4_10",
    "pre5_cfclick",
    "pre5_clclick",
    "pre5_cpagesubmit",
    "pre5_cclickcount",
    "pre5_c",
    "pre6_4fclick",
    "pre6_4lclick",
    "pre6_4pagesubmit",
    "pre6_4clickcount",
    "pre6_4",
    "textmathfclick",
    "textmathlclick",
    "textmathpagesubmit",
    "textmathclickcount",
    "textmath",
    "videomathfclick",
    "videomathlclick",
    "videomathpagesubmit",
    "videomathclickcount",
    "videomath",
    "post1_15fclick",
    "post1_15lclick",
    "post1_15pagesubmit",
    "post1_15clickcount",
    "post1_15",
    "post2_3fclick",
    "post2_3lclick",
    "post2_3pagesubmit",
    "post2_3clickcount",
    "post2_3",
    "post3_6fclick",
    "post3_6lclick",
    "post3_6pagesubmit",
    "post3_6clickcount",
    "post3_6",
    "post4_35fclick",
    "post4_35lclick",
    "post4_35pagesubmit",
    "post4_35clickcount",
    "post4_35",
    "post5_cfclick",
    "post5_clclick",
    "post5_cpagesubmit",
    "post5_cclickcount",
    "post5_c",
    "post6_4fclick",
    "post6_4lclick",
    "post6_4pagesubmit",
    "post6_4clickcount",
    "post6_4",
    "placebofclick",
    "placebolclick",
    "placebopagesubmit",
    "placeboclickcount",
    "placebo",
    "confirmationcode",
    "LocationLatitude",
    "LocationLongitude",
    "LocationAccuracy"
  )
  df$placebo <- "0" # Data file is defaulting to 1.
  return(df)
}


# function to renmae columns by name, buggy needs fixing.
MapDataFrame <- function(df) {
  rename(df, c(
    "V1"="ResponseID",
    "V2"="ResponseSet",
    "V3"="Name",
    "V4"="ExternalDataReference",
    "V5"="EmailAddress",
    "V6"="IPAddress",
    "V7"="Status",
    "V8"="StartDate",
    "V9"="EndDate",
    "V10"="Finished",
    "random"="random",
    "Q17_1"="leveledfclick",
    "Q17_2"="leveledlclick",
    "Q17_3"="leveledpagesubmit",
    "Q17_4"="leveledclickcount",
    "Q2"="leveled",
    "Q23_1"="skillmathfclick",
    "Q23_2"="skillmathlclick",
    "Q23_3"="skillmathpagesubmit",
    "Q23_4"="skillmathclickcount",
    "Q4_1"="skillmath",
    "Q22_1"="englishreadingfclick",
    "Q22_2"="englishreadinglclick",
    "Q22_3"="englishreadingpagesubmit",
    "Q22_4"="englishreadingclickcount",
    "Q5_1"="englishreading",
    "Q21_1"="englishlisteningfclick",
    "Q21_2"="englishlisteninglclick",
    "Q21_3"="englishlisteningpagesubmit",
    "Q21_4"="englishlisteningclickcount",
    "Q6_1"="englishlistening",
    "Q20_1"="ageyearsfclick",
    "Q20_2"="ageyearslclick",
    "Q20_3"="ageyearspagesubmit",
    "Q20_4"="ageyearsclickcount",
    "Q7"="ageyears",
    "Q24_1"="gender1mfclick",
    "Q24_2"="gender1mlclick",
    "Q24_3"="gender1mpagesubmit",
    "Q24_4"="gender1mclickcount",
    "Q8"="gender1m",
    "Q19_1"="countrybirthfclick",
    "Q19_2"="countrybirthlclick",
    "Q19_3"="countrybirthpagesubmit",
    "Q19_4"="countrybirthclickcount",
    "Q10"="countrybirth",
    "Q27_1"="countryresidencefclick",
    "Q27_2"="countryresidencelclick",
    "Q27_3"="countryresidencepagesubmit",
    "Q27_4"="countryresidenceclickcount",
    "Q11"="countryresidence",
    "Q48"="SurveyBegin",
    "Q26_1"="pre1_10fclick",
    "Q26_2"="pre1_10lclick",
    "Q26_3"="pre1_10pagesubmit",
    "Q26_4"="pre1_10clickcount",
    "Q30"="pre1_10",
    "Q33_1"="pre2_10fclick",
    "Q33_2"="pre2_10lclick",
    "Q33_3"="pre2_10pagesubmit",
    "Q33_4"="pre2_10clickcount",
    "Q34"="pre2_10",
    "Q41_1"="pre3_6fclick",
    "Q41_2"="pre3_6lclick",
    "Q41_3"="pre3_6pagesubmit",
    "Q41_4"="pre3_6clickcount",
    "Q43"="pre3_6",
    "Q50_1"="pre4_10fclick",
    "Q50_2"="pre4_10lclick",
    "Q50_3"="pre4_10pagesubmit",
    "Q50_4"="pre4_10clickcount",
    "Q51"="pre4_10",
    "Q52_1"="pre5_cfclick",
    "Q52_2"="pre5_clclick",
    "Q52_3"="pre5_cpagesubmit",
    "Q52_4"="pre5_cclickcount",
    "Q53"="pre5_c",
    "Q54_1"="pre6_4fclick",
    "Q54_2"="pre6_4lclick",
    "Q54_3"="pre6_4pagesubmit",
    "Q54_4"="pre6_4clickcount",
    "Q55"="pre6_4",
    "Q25_1"="textmathfclick",
    "Q25_2"="textmathlclick",
    "Q25_3"="textmathpagesubmit",
    "Q25_4"="textmathclickcount",
    "Q10.1"="textmath",
    "Q29_1"="videomathfclick",
    "Q29_2"="videomathlclick",
    "Q29_3"="videomathpagesubmit",
    "Q29_4"="videomathclickcount",
    "Q15"="videomath",
    "Q35_1"="placebofclick",
    "Q35_2"="placebolclick",
    "Q35_3"="placebopagesubmit",
    "Q35_4"="placeboclickcount",
    "Q32"="placebo",
    "Q28_1"="post1_15fclick",
    "Q28_2"="post1_15lclick",
    "Q28_3"="post1_15pagesubmit",
    "Q28_4"="post1_15clickcount",
    "Q36"="post1_15",
    "Q38_1"="post2_3fclick",
    "Q38_2"="post2_3lclick",
    "Q38_3"="post2_3pagesubmit",
    "Q38_4"="post2_3clickcount",
    "Q37"="post2_3",
    "Q39_1"="post3_6fclick",
    "Q39_2"="post3_6lclick",
    "Q39_3"="post3_6pagesubmit",
    "Q39_4"="post3_6clickcount",
    "Q40"="post3_6",
    "Q44_1"="post4_35fclick",
    "Q44_2"="post4_35lclick",
    "Q44_3"="post4_35pagesubmit",
    "Q44_4"="post4_35clickcount",
    "Q45"="post4_35",
    "Q46_1"="post5_cfclick",
    "Q46_2"="post5_clclick",
    "Q46_3"="post5_cpagesubmit",
    "Q46_4"="post5_cclickcount",
    "Q47"="post5_c",
    "Q48_1"="post6_4fclick",
    "Q48_2"="post6_4lclick",
    "Q48_3"="post6_4pagesubmit",
    "Q48_4"="post6_4clickcount",
    "Q49"="post6_4",
    "Q14"="confirmationcode",
    "LocationLatitude"="LocationLatitude",
    "LocationLongitude"="LocationLongitude",
    "LocationAccuracy"="LocationAccuracy"))
  return(df)
}